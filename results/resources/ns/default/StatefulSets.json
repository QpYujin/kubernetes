[{"metadata":{"name":"my-consul-consul","namespace":"default","selfLink":"/apis/apps/v1beta1/namespaces/default/statefulsets/my-consul-consul","uid":"ce199afc-7dde-11e7-bf00-0ea50f7b4c40","resourceVersion":"1163","generation":1,"creationTimestamp":"2017-08-10T15:15:55Z","labels":{"chart":"consul-0.3.0","component":"my-consul-consul","heritage":"Tiller","release":"my-consul"}},"spec":{"replicas":1,"selector":{"matchLabels":{"chart":"consul-0.3.0","component":"my-consul-consul","heritage":"Tiller","release":"my-consul"}},"template":{"metadata":{"name":"my-consul-consul","creationTimestamp":null,"labels":{"chart":"consul-0.3.0","component":"my-consul-consul","heritage":"Tiller","release":"my-consul"},"annotations":{"pod.alpha.kubernetes.io/initialized":"true"}},"spec":{"volumes":[{"name":"gossip-key","secret":{"secretName":"my-consul-consul-gossip-key","defaultMode":420}}],"containers":[{"name":"my-consul-consul","image":"consul:0.8.3","command":["/bin/sh","-ec","IP=$(hostname -i)\n\nif [ -e /etc/consul/secrets/gossip-key ]; then\n  echo \"{\\\"encrypt\\\": \\\"$(base64 /etc/consul/secrets/gossip-key)\\\"}\" \u003e /etc/consul/encrypt.json\n  GOSSIP_KEY=\"-config-file /etc/consul/encrypt.json\"\nfi\n\nfor i in $(seq 0 $((${INITIAL_CLUSTER_SIZE} - 1))); do\n    while true; do\n        echo \"Waiting for ${STATEFULSET_NAME}-${i}.${STATEFULSET_NAME} to come up\"\n        ping -W 1 -c 1 ${STATEFULSET_NAME}-${i}.${STATEFULSET_NAME}.${STATEFULSET_NAMESPACE}.svc \u003e /dev/null \u0026\u0026 break\n        sleep 1s\n    done\ndone\n\nPEERS=\"\"\nfor i in $(seq 0 $((${INITIAL_CLUSTER_SIZE} - 1))); do\n    PEERS=\"${PEERS}${PEERS:+ } -retry-join $(ping -c 1 ${STATEFULSET_NAME}-${i}.${STATEFULSET_NAME}.${STATEFULSET_NAMESPACE}.svc | awk -F'[()]' '/PING/{print $2}')\"\ndone\n\nexec /bin/consul agent \\\n  -ui \\\n  -disable-host-node-id \\\n  -data-dir=/var/lib/consul \\\n  -server \\\n  -bootstrap-expect=${INITIAL_CLUSTER_SIZE} \\\n  -bind=0.0.0.0 \\\n  -advertise=${IP} \\\n  ${PEERS} \\\n  ${GOSSIP_KEY} \\\n  -client=0.0.0.0\n"],"ports":[{"name":"http","containerPort":8500,"protocol":"TCP"},{"name":"rpc","containerPort":8400,"protocol":"TCP"},{"name":"serflan-tcp","containerPort":8301,"protocol":"TCP"},{"name":"serflan-udp","containerPort":8301,"protocol":"UDP"},{"name":"serfwan-tcp","containerPort":8302,"protocol":"TCP"},{"name":"serfwan-udp","containerPort":8302,"protocol":"UDP"},{"name":"server","containerPort":8300,"protocol":"TCP"},{"name":"consuldns","containerPort":8600,"protocol":"TCP"}],"env":[{"name":"INITIAL_CLUSTER_SIZE","value":"1"},{"name":"STATEFULSET_NAME","value":"my-consul-consul"},{"name":"POD_IP","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"status.podIP"}}},{"name":"STATEFULSET_NAMESPACE","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.namespace"}}}],"resources":{"requests":{"cpu":"100m","memory":"256Mi"}},"volumeMounts":[{"name":"datadir","mountPath":"/var/lib/consul"},{"name":"gossip-key","readOnly":true,"mountPath":"/etc/consul/secrets"}],"livenessProbe":{"exec":{"command":["consul","members"]},"initialDelaySeconds":300,"timeoutSeconds":5,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","securityContext":{"fsGroup":1000},"schedulerName":"default-scheduler"}},"volumeClaimTemplates":[{"metadata":{"name":"datadir","creationTimestamp":null,"annotations":{"volume.alpha.kubernetes.io/storage-class":"default"}},"spec":{"accessModes":["ReadWriteOnce"],"resources":{"requests":{"storage":"1Gi"}}},"status":{"phase":"Pending"}}],"serviceName":"my-consul-consul","updateStrategy":{}},"status":{"observedGeneration":1,"replicas":1}}]